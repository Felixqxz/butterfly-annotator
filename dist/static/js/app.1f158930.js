(function(t){function e(e){for(var a,n,r=e[0],l=e[1],c=e[2],u=0,p=[];u<r.length;u++)n=r[u],Object.prototype.hasOwnProperty.call(o,n)&&o[n]&&p.push(o[n][0]),o[n]=0;for(a in l)Object.prototype.hasOwnProperty.call(l,a)&&(t[a]=l[a]);d&&d(e);while(p.length)p.shift()();return i.push.apply(i,c||[]),s()}function s(){for(var t,e=0;e<i.length;e++){for(var s=i[e],a=!0,r=1;r<s.length;r++){var l=s[r];0!==o[l]&&(a=!1)}a&&(i.splice(e--,1),t=n(n.s=s[0]))}return t}var a={},o={app:0},i=[];function n(e){if(a[e])return a[e].exports;var s=a[e]={i:e,l:!1,exports:{}};return t[e].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=t,n.c=a,n.d=function(t,e,s){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},n.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)n.d(s,a,function(e){return t[e]}.bind(null,a));return s},n.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/";var r=window["webpackJsonp"]=window["webpackJsonp"]||[],l=r.push.bind(r);r.push=e,r=r.slice();for(var c=0;c<r.length;c++)e(r[c]);var d=l;i.push([0,"chunk-vendors"]),s()})({0:function(t,e,s){t.exports=s("56d7")},"034f":function(t,e,s){"use strict";s("85ec")},"423e":function(t,e,s){},5697:function(t,e,s){},"56d7":function(t,e,s){"use strict";s.r(e);var a=s("2b0e"),o=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{attrs:{id:"app"}},[s("Header"),s("router-view",{staticClass:"container container-fluid"}),s("Footer")],1)},i=[],n=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("b-navbar",{staticClass:"mb-5",attrs:{toggleable:"lg",type:"dark",variant:"dark"}},[s("b-navbar-brand",[s("router-link",{attrs:{to:"/"}},[t._v("Butterfly annotator")])],1),s("b-navbar-toggle",{attrs:{target:"nav-collapse"}}),s("b-collapse",{attrs:{id:"nav-collapse","is-nav":""}},[s("b-navbar-nav",{staticClass:"ml-auto"},[s("b-navbar-nav",{directives:[{name:"show",rawName:"v-show",value:!t.isLoggedIn,expression:"!isLoggedIn"}]},[s("b-nav-item",[s("router-link",{attrs:{to:"/register"}},[t._v("Register")])],1)],1),s("b-navbar-nav",{directives:[{name:"show",rawName:"v-show",value:!t.isLoggedIn,expression:"!isLoggedIn"}]},[s("b-nav-item",[s("router-link",{attrs:{to:"/login"}},[t._v("Login")])],1)],1),s("b-nav-item-dropdown",{directives:[{name:"show",rawName:"v-show",value:t.isLoggedIn,expression:"isLoggedIn"}],attrs:{right:""},scopedSlots:t._u([{key:"button-content",fn:function(){return[s("em",[t._v(t._s(t.username()))])]},proxy:!0}])},[s("b-dropdown-item",{on:{click:function(e){return t.redirectToProfile()}}},[t._v("Profile")]),s("b-dropdown-item",{on:{click:function(e){return t.logout()}}},[t._v("Sign Out")])],1)],1)],1)],1)],1)},r=[],l=s("2f62");const c=(t,e,s)=>{t.toast(s,{title:e,variant:"danger",solid:!0})};var d=c,u={name:"Header",computed:{...Object(l["c"])({user:"currentUser",isLoggedIn:"isLoggedIn"})},methods:{...Object(l["b"])({doLogOut:"logOut"}),logout(){const t=this;this.doLogOut().then(e=>t.$router.push("/login")).catch(t=>d(this.$bvToast,"Could not log out","Cause: "+t.response.data.message))},username(){return this.isLoggedIn?this.user.username:""},redirectToProfile(){this.$router.push({path:"/settings"})}}},p=u,m=(s("8baf"),s("2877")),h=Object(m["a"])(p,n,r,!1,null,null,null),g=h.exports,b=function(){var t=this,e=t.$createElement;t._self._c;return t._m(0)},f=[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("footer",{staticClass:"small mdb-color pt-4",attrs:{id:"footer"}},[s("p",{staticClass:"text-center no-drag"},[t._v("Â© 2021 Copyright: butterfly-annotator")])])}],v={name:"Footer"},y=v,k=(s("760c"),Object(m["a"])(y,b,f,!1,null,null,null)),w=k.exports,_={components:{Header:g,Footer:w}},x=_,C=(s("034f"),Object(m["a"])(x,o,i,!1,null,null,null)),I=C.exports,P=s("8c4f"),T=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("b-container",{on:{mousemove:t.trackMouse}},[s("div",{staticClass:"helper"},[s("b-button",{directives:[{name:"b-modal",rawName:"v-b-modal.help",modifiers:{help:!0}}],staticStyle:{"border-radius":"1rem 1rem 0 0"}},[t._v("Help?")])],1),s("b-modal",{attrs:{id:"help","hide-footer":"",scrollable:"",title:"How to annotate images?"}},[s("h5",[t._v("General advice:")]),s("ul",[s("li",[t._v(" When you first arrive here, there will be automatically generated suggestions for you of text bits that you could want to use for your annotations. ")]),s("li",[t._v(" You can delete bits by clicking the cross in their badge, and add some by selecting the bit of text you want and then pressing the "),s("b-badge",[t._v("Add bit")]),t._v(" button. ")],1),s("li",[t._v(" Click points on the canvas to start drawing a polygon. Click the first point you've drawn to finish a polygon. Then, choose one of the bits of text you've chosen to associate it with and create a complete annotation. If you don't want to add it now, you can always press "),s("b-badge",[t._v("Escape")]),t._v(" or click elsewhere, and come back to the selection menu of the polygon by simply clicking that polygon again. ")],1),s("li",[t._v(" Don't forget to press "),s("b-badge",[t._v("Save")]),t._v(" to make your changes effective! ")],1)]),s("hr"),s("h5",[t._v(" Basic commands ")]),s("ul",[s("li",[t._v(" Press "),s("b-badge",[t._v("Escape")]),t._v(" to stop your drawing. ")],1),s("li",[t._v(" Click the last point you've created to remove it. ")]),s("li",[s("b-badge",[t._v("Shift + Click")]),t._v(" when your cursor is close enough to a polygon to delete it. ")],1),s("li",[t._v(" Place your cursor over a point of a polygon and start dragging it (hold your mouse's left button) to move it. ")]),s("li",[t._v(" You can Undo ("),s("b-badge",[t._v("Ctrl + Z")]),t._v(") and Redo ("),s("b-badge",[t._v("Ctrl + Y")]),t._v(") the following actions: adding a polygon, removing a polygon, moving a point in a polygon. ")],1)])]),s("b-row",{staticClass:"mb-2"},[s("b-col",{attrs:{cols:"12"}},[s("router-link",{attrs:{to:"/bank/"+t.bankId}},[t._v("Back to bank")])],1)],1),s("b-row",{staticClass:"justify-content-between mb-2"},[s("b-col",{attrs:{cols:"1"}},[s("b-button",{attrs:{disabled:!t.hasPreviousImage},on:{click:function(e){return t.previousImage()}}},[t._v(" Previous ")])],1),s("b-col",{attrs:{cols:"1"}},[s("b-button",{directives:[{name:"tippy",rawName:"v-tippy",value:{theme:"google",arrow:!0,arrowType:"round"},expression:"{theme: 'google', arrow: true, arrowType: 'round'}"}],attrs:{content:"Save the changes made to the image's annotations."},on:{click:function(e){return t.saveAnnotations()}}},[t._v(" Save ")])],1),s("b-col",{attrs:{cols:"1"}},[s("b-button",{attrs:{disabled:!t.hasNextImage},on:{click:function(e){return t.nextImage()}}},[t._v(" Next ")])],1)],1),s("b-row",{staticClass:"justify-content-center mb-2"},[s("b-col",{attrs:{cols:"1"}},[s("div",{directives:[{name:"tippy",rawName:"v-tippy",value:{arrow:!0,arrowType:"round",theme:"google"},expression:"{arrow: true, arrowType: 'round', theme: 'google'}"}],staticStyle:{display:"inline-block"},attrs:{content:t.undoDisabled?"Nothing to undo!":"Undo (Ctrl + Z)"}},[s("b-button",{attrs:{disabled:t.undoDisabled},on:{click:function(e){return t.undo()}}},[s("b-icon-arrow-counterclockwise")],1)],1)]),s("b-col",{attrs:{cols:"1"}},[s("div",{directives:[{name:"tippy",rawName:"v-tippy",value:{arrow:!0,arrowType:"round",theme:"google"},expression:"{arrow: true, arrowType: 'round', theme: 'google'}"}],staticStyle:{display:"inline-block"},attrs:{content:t.redoDisabled?"Nothing to redo!":"Redo (Ctrl + Y)"}},[s("b-button",{attrs:{disabled:t.redoDisabled},on:{click:function(e){return t.redo()}}},[s("b-icon-arrow-clockwise")],1)],1)])],1),s("b-row",{staticClass:"justify-content-center mb-2"},[s("div",{staticStyle:{display:"none"},attrs:{id:"tooltip-content"}},[t.hasNoDescription?s("div",[s("p",[t._v("This polygon has no description!")]),s("p",[t._v("Please choose one:")]),s("b-form-select",{staticClass:"mb-2",attrs:{id:t.formDummyId,options:t.descriptionOptions(),size:"sm"}}),s("b-button",{attrs:{variant:"primary",size:"sm",onclick:"addAnnotation()",disabled:0===t.descriptionOptions().filter((function(t){return!t.disabled})).length}},[t._v("Add!")])],1):s("div",[s("p",[t._v("This polygon has a description:")]),s("p",[s("em",[t._v(t._s(t.descriptionOfSelectedPolygon))])]),s("p",[t._v("Last editor: "),s("em",[t._v(t._s(t.authorOfSelectedPolygon))])])])]),s("div",{staticStyle:{position:"absolute !important"},attrs:{id:"mouse-position"}}),s("div",{attrs:{id:"canvas"}})]),s("b-row",{staticClass:"mb-2"},[s("b-col",{attrs:{cols:"12"}},[s("b-card",{on:{mouseup:function(e){return t.checkTextSelection()},mousedown:function(e){return t.checkTextSelection()}}},[s("p",{staticStyle:{"white-space":"pre-wrap","margin-bottom":"0"},attrs:{id:"description"}},t._l(t.createChunks(),(function(e){return s("span",{key:e.start},[e.selected?s("description-bit",{attrs:{text:e.text,"start-index":e.start,"click-handler":t.handleBitClick,author:e.author,suggested:e.suggested}}):s("span",[t._v(t._s(e.text))])],1)})),0)])],1)],1),s("b-row",[s("b-col",{attrs:{cols:"12"}},[s("b-button",{attrs:{disabled:!t.canAddBit},on:{click:function(e){return t.addTextBit()}}},[t._v(" Add bit ")])],1)],1)],1)},D=[],N=s("3425"),O=s.n(N),B=s("6018"),A=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("b-badge",{directives:[{name:"tippy",rawName:"v-tippy",value:{arrow:!0,arrowType:"round",theme:"google"},expression:"{arrow: true, arrowType: 'round', theme: 'google'}"}],staticClass:"no-drag",attrs:{content:t.tooltipContent,variant:t.badgeVariant}},[t._v(t._s(t.text)),s("b-icon-x-circle-fill",{staticClass:"rem-button",attrs:{size:"sm",pill:""},on:{click:function(e){return t.clickHandler(t.startIndex)}}})],1)},$=[],S={name:"DescriptionBit",props:{text:{type:String,required:!0},startIndex:{type:Number,required:!0},clickHandler:{type:Function,required:!0},author:{type:String,required:!1},suggested:{type:Boolean,required:!1}},computed:{badgeVariant(){return this.author?"primary":this.suggested?"secondary":"warning"},tooltipContent(){return this.author?`<em>${this.author}</em> has used this bit of description`:this.suggested?"This is an automatic suggestion":"This description bit is not assigned"}}},E=S,U=(s("fa66"),Object(m["a"])(E,A,$,!1,null,"52de14c2",null)),j=U.exports;class F{constructor(t,e){this.dots=t,this.i=e}}class H{constructor(t,e){this.redo=t,this.undo=e}}class L{constructor(t,e,s){this.next=t,this.previous=e,this.action=s}hasNext(){return null!==this.next}hasPrevious(){return null!==this.previous}}var q={name:"AnnotateImage",components:{DescriptionBit:j},data(){return{imageData:null,availablePolygons:[],hasPreviousImage:!1,hasNextImage:!1,bankId:-1,canAddBit:!1,selectedBits:[],selectedPolygon:-1,chunkedDescription:[],mousePosX:0,mousePosY:0,previousTippy:null,firstHistoryNode:null,lastHistoryNode:null,currentHistoryNode:null}},watch:{$route(t,e){if(t!==e){const t=document.getElementById("defaultCanvas0");t&&t.parentNode.removeChild(t),this.hasNextImage=!1,this.hasPreviousImage=!1,this.availablePolygons=[],this.selectedBits=[],this.chunkedDescription=[],this.canAddBit=!1,this.selectedPolygon=-1,this.previousTippy&&(this.previousTippy.destroy(),this.previousTippy=null),this.firstHistoryNode=null,this.lastHistoryNode=null,this.currentHistoryNode=null,this.initializeAll()}}},computed:{...Object(l["c"])({user:"currentUser"}),redoDisabled(){return!this.lastHistoryNode||(this.currentHistoryNode.next===this.lastHistoryNode||this.lastHistoryNode.previous===this.firstHistoryNode)},undoDisabled(){return!this.lastHistoryNode||(this.currentHistoryNode===this.firstHistoryNode||this.lastHistoryNode.previous===this.firstHistoryNode)},hasNoDescription(){return-1===this.selectedPolygon||!this.availablePolygons[this.selectedPolygon].hasDescription},descriptionOfSelectedPolygon(){if(this.hasNoDescription)return"";const t=this.availablePolygons[this.selectedPolygon].i,e=this.imageData.annotations.find(e=>e.polygon&&e.polygon.i===t);return this.imageData.description.substring(e.description.start,e.description.end)},authorOfSelectedPolygon(){if(this.hasNoDescription)return"";const t=this.availablePolygons[this.selectedPolygon].i;return this.imageData.annotations.find(e=>e.polygon&&e.polygon.i===t).author},formDummyId(){return"XXXXX"},formActualId(){return"tooltip-selected-description"}},methods:{...Object(l["b"])({fetchImageData:"fetchImageData",sendAnnotations:"sendAnnotations"}),descriptionOptions(){const t=[];for(let e=0;e<this.selectedBits.length;++e){const s=this.selectedBits[e];t.push({value:e,text:this.imageData.description.substring(s.start,s.end),disabled:Boolean(s.annotation)})}return t},trackMouse(t){this.mousePosX=t.pageX,this.mousePosY=t.pageY},previousImage(){const t="/annotate/"+this.imageData.hasPrevious;this.$router.push({path:t}),this.$router.go()},nextImage(){const t="/annotate/"+this.imageData.hasNext;this.$router.push({path:t}),this.$router.go()},addAnnotation(){if(-1===this.selectedPolygon||0===this.selectedBits.length)return;const t=this.availablePolygons[this.selectedPolygon];t.hasDescription=!0;const e=document.getElementById(this.formActualId).value,s=this.selectedBits[e],a={polygon:t,description:s,author:this.user.username};s.annotation=a,this.imageData.annotations.push(a),this.previousTippy&&(this.previousTippy.destroy(),this.previousTippy=null),this.selectedPolygon=-1},createTooltip(){const t=document.getElementById("mouse-position");t.style.left=this.mousePosX+"px",t.style.top=this.mousePosY+"px",this.previousTippy&&this.previousTippy.destroy();const e=document.getElementById("tooltip-content").innerHTML.replace(this.formDummyId,this.formActualId);this.previousTippy=Object(B["c"])("#mouse-position",{content:e,interactive:!0})[0];const s=this;return setTimeout(()=>{s.previousTippy&&s.previousTippy.show()},100),this.previousTippy},createChunks(){if(!this.imageData)return[];if(0===this.selectedBits.length)return[{text:this.imageData.description,selected:!1}];let t=[],e=0;for(let a=0;a<this.selectedBits.length;++a){const s=this.selectedBits[a];s.start!==e&&t.push({text:this.imageData.description.substring(e,s.start),selected:!1,start:e}),t.push({text:this.imageData.description.substring(s.start,s.end),selected:!0,start:s.start,author:s.annotation?s.annotation.author:"",suggested:s.suggested}),e=s.end}const s=this.selectedBits[this.selectedBits.length-1];return s.end!==this.imageData.description.length&&t.push({text:this.imageData.description.substring(s.end),selected:!1,start:s.end}),t},handleBitClick(t){const e=this.selectedBits.findIndex(e=>e.start===t);if(-1===e)return;this.selectedBits.splice(e,1);const s=this.imageData.annotations.find(e=>e.description.start===t);s&&(s.toRemove=!0,s.description=null,s.polygon&&(s.polygon.hasDescription=!1))},saveAnnotations(){const t=t=>!(t.toRemove&&!t.id),e=this.imageData.annotations.filter(t).map(t=>{const e=t.id?t.id:-1;return t.toRemove?{id:e,rem:!0}:{id:e,points:t.polygon.dots.map(t=>({x:Math.floor(t.x),y:Math.floor(t.y)})),tag:{start:t.description.start,end:t.description.end}}}),s=this;this.sendAnnotations({data:{imageId:this.$route.params.imageId,annotations:e}}).then(e=>{s.imageData.annotations=s.imageData.annotations.filter(t);for(let t=0;t<s.imageData.annotations.length;++t){const a=s.imageData.annotations[t];a.id=e.data.ids[t]}s.$bvToast.toast("Done.",{title:"Successfully saved annotations!",variant:"success",solid:!0})}).catch(t=>d(this.$bvToast,"Could not save annotations","Cause: "+t.response.data.message))},descriptionIndices(t){const e=this.imageData.description.indexOf(t),s=e+t.trim().length;return{start:e,end:s}},checkTextSelection(){const t=window.getSelection(),e=t.toString(),{start:s,end:a}=this.descriptionIndices(e);if(this.selectedBits.some(t=>s<=t.end&&t.start<=a))return void(this.canAddBit=!1);const o=e.trim();this.canAddBit=!!o},addTextBit(){const t=window.getSelection(),e=t.toString(),s=e.trim();if(!s)return;const{start:a,end:o}=this.descriptionIndices(e);this.selectedBits.push({start:a,end:o}),this.selectedBits.sort((t,e)=>t.start-e.start),t.empty(),this.canAddBit=!1},undo(){if(this.undoDisabled)return;const t=this.currentHistoryNode;t.action.undo(),this.currentHistoryNode=t.previous},redo(){if(this.redoDisabled)return;const t=this.currentHistoryNode;t.next.action.redo(),this.currentHistoryNode=t.next},pushHistory(t,e){const s=new L(this.lastHistoryNode,this.currentHistoryNode,new H(t,e));this.currentHistoryNode.next=s,this.lastHistoryNode.previous=s,this.currentHistoryNode=s,t()},initializeAll(){const t=this,e=e=>{e.disableFriendlyErrors=!0;const s=(t,s,a)=>{e.stroke(t);for(let o=0;o<s.length-1;o++){const t=s[o],a=s[o+1];e.line(t.x,t.y,a.x,a.y)}if(a){const t=s[0],a=s[s.length-1];e.line(a.x,a.y,t.x,t.y)}e.noStroke(),e.fill(t);for(let i=0;i<s.length;++i){const t=s[i];e.ellipse(t.x,t.y,o)}},a=15,o=9,i=2,n=4,r=e.SHIFT,l=50,c=t=>e.color(16*t%256,64*(t+1)%256,30*t%256,150),d=()=>{const s=e.createVector(e.mouseX,e.mouseY);for(let e=0;e<t.availablePolygons.length;++e){const a=t.availablePolygons[e];for(let t=0;t<a.dots.length;++t){const o=a.dots[t];if(g(o,s))return{dot:o,polygon:e,dotIdx:t}}}return null},u=(t,e)=>{let s=0,a=0;for(let o=0;o<e.dots.length;++o){const i=e.dots[o],n=e.dots[(o+1)%e.dots.length],r=n.x-i.x,l=n.y-i.y,c=t.x-i.x,d=t.y-i.y,u=c*r+d*l,p=u/(r*r+l*l);let m=0,h=0;p<0?(m=i.x,h=i.y):p>1?(m=n.x,h=n.y):(m=i.x+p*r,h=i.y+p*l);const g=t.x-m,b=t.y-h,f=g*g+b*b;(f<s||0===o)&&(s=f,a=o)}return{distance:s,index:a}},p=()=>{const s=e.createVector(e.mouseX,e.mouseY);let a=-1,o=-1,i=Number.POSITIVE_INFINITY;for(let e=0;e<t.availablePolygons.length;++e){const n=t.availablePolygons[e],{distance:r,index:l}=u(s,n);i>r&&(i=r,o=l,a=e)}return{polygon:a,dotsIdx:o,distance:i}},m=()=>0<e.mouseX&&e.mouseX<t.imageData.width&&0<e.mouseY&&e.mouseY<t.imageData.height,h=(t,e)=>{const s=t.x-e.x,a=t.y-e.y;return s*s+a*a},g=(t,e)=>h(t,e)<a*a,b=(t,e)=>s(t,e.dots,!0),f=()=>t.availablePolygons.length>0?t.availablePolygons[t.availablePolygons.length-1].i+1:0,v=(e,s)=>{const a=Object.assign({},t.availablePolygons[e]);a.hasDescription=!1;const o=t.selectedPolygon,i=t.imageData.annotations.find(t=>t.polygon&&t.polygon.i===e);if(i){const e=t.selectedBits.find(t=>t.annotation===i);e.annotation=null}const n=()=>{const s=t.imageData.annotations.findIndex(t=>t.polygon&&t.polygon.i===a.i),o=-1!==s?t.imageData.annotations[s]:null;t.availablePolygons.splice(e,1),o&&t.imageData.annotations.length>s&&t.imageData.annotations[s]===o&&(o.toRemove=!0,o.polygon=null,o.description&&(o.description.annotation=null)),t.selectedPolygon=-1},r=()=>{const s=t.imageData.annotations.findIndex(t=>t.polygon&&t.polygon.i===a.i),i=-1!==s?t.imageData.annotations[s]:null;t.availablePolygons.splice(e,0,a),i&&t.imageData.annotations.length>s&&t.imageData.annotations[s]===i&&(i.toRemove=!1,i.polygon=a,i.description&&(i.description.annotation=i)),t.selectedPolygon=o};s?t.pushHistory(n,r):n()};let y=[],k=void 0,w=null,_=null;e.setup=()=>{e.createCanvas(t.imageData.width,t.imageData.height),k=e.loadImage("http://127.0.0.1:"+(Object({NODE_ENV:"production",VUE_APP_ROOT_API:"https://butterfly-annotator.herokuapp.com",BASE_URL:"/"}).PORT?Object({NODE_ENV:"production",VUE_APP_ROOT_API:"https://butterfly-annotator.herokuapp.com",BASE_URL:"/"}).PORT:"5000")+"/api/"+t.imageData.imageUrl),e.frameRate(l)},e.draw=()=>{if(e.image(k,0,0,t.imageData.width,t.imageData.height),e.strokeWeight(n),w&&(t.availablePolygons[w.polygon].dots[w.dotIdx]=e.createVector(e.mouseX,e.mouseY)),t.availablePolygons.forEach(t=>b(c(t.i),t)),y.length>0){const t=c(f());s(t,y,!1),e.stroke(t);const a=y[y.length-1];e.line(a.x,a.y,e.mouseX,e.mouseY)}const l=p();if((!l||l.distance>=a||y.length>0)&&(e.strokeWeight(i),e.fill(c(t.availablePolygons.length)),e.ellipse(e.mouseX,e.mouseY,o)),e.keyIsDown(r))e.cursor(e.HAND);else{const t=d();t?e.cursor(e.MOVE):e.cursor(e.ARROW)}},e.keyPressed=()=>{if(e.keyCode===e.ESCAPE){if(t.previousTippy){const e=t.previousTippy;t.previousTippy=null,e.hide(),setTimeout(()=>e.destroy(),500)}t.selectedPolygon=-1,y=[]}else if(e.keyIsDown(e.CONTROL)){const s=90,a=89;e.keyCode===s?t.undo():e.keyCode===a&&t.redo()}},e.mousePressed=()=>{if(!m())return;const t=d();!t||y.length>0||(w=t,_||(_=e.createVector(t.dot.x,t.dot.y)))},e.mouseReleased=()=>{if(m()&&(!t.previousTippy||!t.previousTippy.isVisible)){const s=e.createVector(e.mouseX,e.mouseY);if(w){const e=_,a=w,o=()=>{t.availablePolygons[a.polygon].dots[a.dotIdx]=s},i=()=>{t.availablePolygons[a.polygon].dots[a.dotIdx]=e};return _=null,w=null,void t.pushHistory(o,i)}const o=p();if(e.keyIsDown(r))return void(o&&o.distance<a*a&&v(o.polygon,!0));if(o.distance<a*a&&0===y.length)return t.selectedPolygon=o.polygon,void setTimeout(()=>t.createTooltip(),1);if(0===y.length){const e=p();return void(e&&e.distance<a*a?t.selectedPolygon=e.polygon:y.push(s))}if(y.length<=2){const t=y[0];if(g(t,s))y.pop();else if(2===y.length){const t=y[1];g(t,s)?y.pop():y.push(s)}else y.push(s);return}const i=y[0];if(g(i,s)){const e=t.createTooltip(),s=f(),a=new F(y,s);y=[];const o=()=>{t.availablePolygons.push(a),t.selectedPolygon=s;const e=t.imageData.annotations.find(t=>t.polygon&&t.polygon.i===a.i);e&&(e.toRemove=!1,e.description.annotation=e)},i=()=>{e&&e.destroy(),v(s,!1)};return void this.pushHistory(o,i)}const n=y[y.length-1];if(g(n,s))return void y.pop();y.push(s)}}};this.fetchImageData({imageId:this.$route.params.imageId}).then(t=>{this.imageData=t.data,this.bankId=this.imageData.bankId,this.hasNextImage=-1!==this.imageData.hasNext,this.hasPreviousImage=-1!==this.imageData.hasPrevious,this.imageData.annotations.forEach((t,e)=>{let s=[];t.regionInfo.split(";").forEach(t=>{const e=t.split(",");s.push(new O.a.Vector(parseInt(e[0]),parseInt(e[1])))});const a=new F(s,e);a.hasDescription=!0,t.polygon=a,this.selectedBits.push({start:t.description.start,end:t.description.end,annotation:t}),this.availablePolygons.push(a)}),this.imageData.annotations&&0!==this.imageData.annotations.length||this.imageData.suggestions.forEach(t=>{this.selectedBits.push({start:t.start,end:t.end,suggested:!0})}),this.selectedBits.sort((t,e)=>t.start-e.start);new O.a(e,"canvas")}).catch(t=>d(this.$bvToast,"Could not load annotations","Cause "+t.response.data.message))}},mounted(){this.initializeAll()},created(){window.addAnnotation=this.addAnnotation,this.firstHistoryNode=new L(null,null),this.lastHistoryNode=new L(null,this.firstHistoryNode),this.firstHistoryNode.next=this.lastHistoryNode,this.currentHistoryNode=this.firstHistoryNode}},R=q,V=(s("d5e7"),Object(m["a"])(R,T,D,!1,null,"0fad4d3d",null)),Y=V.exports,M=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("b-container",[s("h2",{staticClass:"page-title"},[t._v(" Bank: "+t._s(t.bankName)+" "),s("b-button",{directives:[{name:"b-modal",rawName:"v-b-modal.settings-modal",modifiers:{"settings-modal":!0}}],attrs:{variant:"secondary"}},[s("b-icon-gear")],1),s("b-modal",{attrs:{id:"settings-modal",title:"Settings","hide-footer":""}},[s("b-button",{attrs:{variant:"danger",disabled:t.currentAccess>=90},on:{click:t.deleteBank}},[t._v(" Delete bank ")])],1)],1),s("b-row",[s("b-col",[s("p",[s("router-link",{attrs:{to:"/"}},[t._v("Return to the list of banks")])],1)])],1),s("b-tabs",{attrs:{justified:""},scopedSlots:t._u([{key:"tabs-end",fn:function(){return[s("b-nav-item",{attrs:{href:"#",role:"presentation"},on:{click:function(e){return t.downloadJson()}}},[s("b-icon-download",{staticClass:"pr-2"}),t._v("Export to JSON")],1)]},proxy:!0}])},[s("b-tab",{attrs:{title:"Images",active:""}},[s("form",[s("b-row",[s("b-col",{staticClass:"mt-2",attrs:{cols:"12"}},[s("b-input-group",{on:{keydown:function(e){if(!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter"))return null;e.preventDefault()}}},[s("b-input-group-prepend",[s("b-input-group-text",[s("b-icon-search")],1)],1),s("input",{directives:[{name:"model",rawName:"v-model",value:t.searchText,expression:"searchText"}],staticClass:"form-control",attrs:{type:"text",placeholder:"Search..."},domProps:{value:t.searchText},on:{input:function(e){e.target.composing||(t.searchText=e.target.value)}}})],1)],1)],1)],1),s("b-row",t._l(t.imagesToShow,(function(e){return s("b-col",{key:e.id,attrs:{md:"4",sm:"6",xs:"12"}},[s("router-link",{attrs:{to:"/annotate/"+e.id}},[s("b-card",{staticClass:"card-hover no-drag image-to-annotate fade-in-with-style",attrs:{"no-body":""}},[s("div",{staticClass:"image-hover-container"},[s("img",{staticClass:"card-img-top image-hover image-in-place",attrs:{src:t.$hostname+"/api/"+e.url,alt:e.id}}),Boolean(e.lastEditor)?s("div",{directives:[{name:"tippy",rawName:"v-tippy",value:{content:"<em>"+e.lastEditor.username+"</em> last annotated this",arrow:!0,arrowType:"round",theme:"google"},expression:"{content: `<em>${image.lastEditor.username}</em> last annotated this`, arrow: true, arrowType: 'round', theme: 'google'}"}],staticClass:"last-editor",style:"background-image: url("+t.$hostname+"/api/profile-picture/"+e.lastEditor.username+")"}):t._e()]),s("b-card-body",{staticClass:"row justify-content-between align-items-center"},[s("b-col",{attrs:{cols:"12"}},[s("b-card-text",[t._v(t._s(e.fullDescription.substring(0,120))+"...")])],1)],1)],1)],1)],1)})),1)],1),s("b-tab",{attrs:{title:"Accesses"}},[s("b-row",{attrs:{"v-show":t.hasPermissionToAdd()}},[s("b-col",{attrs:{cols:"12"}},[s("b-button",{directives:[{name:"b-modal",rawName:"v-b-modal.add",modifiers:{add:!0}}],staticClass:"mb-2 mt-2",attrs:{variant:"primary"}},[t._v("Add user")])],1),s("b-modal",{ref:"add-modal",attrs:{id:"add",title:"Add user","hide-footer":""}},[s("b-form",{attrs:{autocomplete:"off"}},[s("h4",{staticClass:"text-center"},[t._v("Add a user to this group")]),s("b-form-group",{attrs:{id:"user-add-input","label-for":"target-user"}},[s("label",[t._v("Username:")]),s("b-form-input",{attrs:{id:"target-user",name:"target-user"},model:{value:t.targetUser,callback:function(e){t.targetUser=e},expression:"targetUser"}})],1),s("b-form-group",[s("b-form-select",{attrs:{options:t.permissionOptions},model:{value:t.selectedLevel,callback:function(e){t.selectedLevel=e},expression:"selectedLevel"}})],1),s("b-button",{on:{click:function(e){return t.addUser()}}},[t._v(" Add ")])],1)],1)],1),t._l(t.userAccesses,(function(e){return s("b-row",{key:e.username,staticClass:"mb-2 justify-content-center"},[s("b-col",{attrs:{cols:"12"}},[s("b-card",[t._v(" "+t._s(e.username)+" "),s("permission-badge",{attrs:{"color-variant":t.levelToVariant(e.level),"permission-title":t.levelToTitle(e.level)}}),s("b-button",{staticClass:"float-right remove-user-button",attrs:{variant:"danger"},on:{click:function(s){return t.removeUser(e.username)}}},[s("b-icon-x-circle")],1)],1)],1)],1)}))],2)],1)],1)},X=[],z=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("b-badge",{attrs:{variant:t.colorVariant}},[t._v(" "+t._s(t.permissionTitle)+" ")])},J=[],W={name:"PermissionBadge",props:{colorVariant:{type:String,required:!0},permissionTitle:{type:String,required:!0}}},Z=W,G=Object(m["a"])(Z,z,J,!1,null,null,null),K=G.exports,Q={name:"ImageList",components:{PermissionBadge:K},data(){return{images:[],bankName:"(loading)",userAccesses:[],currentAccess:null,selectedLevel:null,permissionOptions:[],targetUser:null,searchText:""}},computed:{...Object(l["c"])({userInfo:"currentUser"}),imagesToShow(){const t=this.searchText.trim();return t?this.images.filter(e=>e.fullDescription.toLowerCase().includes(t.toLowerCase())):this.images}},methods:{...Object(l["b"])({listImages:"listImages",listAccesses:"listAccesses",requestPermission:"requestPermission",requestJson:"requestBankJson",requestDeleteBank:"deleteBank"}),hasPermissionToAdd(){return!!this.currentAccess&&this.currentAccess>=70},levelToTitle(t){return 0===t?"Viewer":50===t?"Editor":70===t?"Moderator":90===t?"Admin":100===t?"Super Admin":"Invalid level"},levelToVariant(t){return 0===t?"light":50===t?"primary":70===t?"success":90===t||100===t?"danger":"secondary"},fetchImageList(){this.listImages({bankId:this.$route.params.bankId}).then(t=>{let e=t.data;this.images=e.images,this.bankName=e.bankName}).catch(t=>{d(this.$bvToast,"Cannot load image list","Cause "+t.response.data.message)})},relistAccesses(){this.listAccesses({bankId:this.$route.params.bankId}).then(t=>{this.userAccesses=t.data.users,this.userAccesses.sort((t,e)=>e.level-t.level);for(let e=0;e<t.data.users.length;++e){const s=t.data.users[e];if(s.username===this.userInfo.username){this.currentAccess=s,this.currentAccess.level>=70&&(this.permissionOptions=["Visitor","Editor","Moderator"]),this.currentAccess.level>=90&&this.permissionOptions.push("Admin");break}}}).catch(t=>d(this.$bvToast,"Cannot load accesses","Cause "+t.response.data.message))},addUser(){const t=this.targetUser;let e=null;"Visitor"===this.selectedLevel?e=0:"Editor"===this.selectedLevel?e=50:"Moderator"===this.selectedLevel?e=70:"Admin"===this.selectedLevel&&(e=90),this.$refs["add-modal"].hide();const s=this.$route.params.bankId;this.requestPermission({targetUser:t,level:e,bankId:s}).then(t=>{this.relistAccesses()}).catch(t=>d(this.$bvToast,"Cannot add user","Cause: "+t.response.data.message))},removeUser(t){const e=t,s=-1,a=this.$route.params.bankId;this.requestPermission({targetUser:e,level:s,bankId:a}).then(t=>{this.relistAccesses()}).catch(t=>d(this.$bvToast,"Cannot remove user","Cause: "+t.response.data.message))},downloadJson(){this.requestJson({bankId:this.$route.params.bankId}).then(t=>{const e=new Blob([JSON.stringify(t.data,null,2)],{type:"application/json"}),s=document.createElement("a");s.href=URL.createObjectURL(e),s.download="bank.json",s.click(),URL.revokeObjectURL(s.href)})},deleteBank(){this.requestDeleteBank({bankId:this.$route.params.bankId}).then(t=>{this.$router.push({path:"/"}),this.$bvToast.toast("Successfully deleted bank",{title:"Deleted "+this.bankName,variant:"success",solid:!0})}).catch(t=>d(this.$bvToast,"Could not delete bank","Cause: "+t.response.data.message))}},created(){this.fetchImageList(),this.relistAccesses()}},tt=Q,et=(s("9d0d"),Object(m["a"])(tt,M,X,!1,null,"35e05470",null)),st=et.exports,at=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{staticClass:"row justify-content-center align-items-center",attrs:{id:"login-row"}},[s("div",{staticClass:"col-md-6",attrs:{id:"login-column"}},[s("div",{staticClass:"col-md-12",attrs:{id:"login-box"}},[s("b-form",{attrs:{autocomplete:"off"}},[s("h3",{staticClass:"text-center"},[t._v("Login")]),s("b-form-group",{attrs:{id:"input-group-1","label-for":"username"}},[s("label",[t._v("Username:")]),s("b-form-input",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],attrs:{id:"username",name:"username",state:t.validateState("username")},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.submitForm()}},model:{value:t.form.username,callback:function(e){t.$set(t.form,"username",e)},expression:"form.username"}}),s("b-form-invalid-feedback",{attrs:{id:"username"}},[t._v(t._s(t.veeErrors.first("username")))])],1),s("b-form-group",{attrs:{id:"input-group-2","label-for":"password"}},[s("label",[t._v("Password:")]),s("b-form-input",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],attrs:{id:"password",name:"password",type:"password",state:t.validateState("password")},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.submitForm()}},model:{value:t.form.password,callback:function(e){t.$set(t.form,"password",e)},expression:"form.password"}}),s("b-form-invalid-feedback",{attrs:{id:"password"}},[t._v(t._s(t.veeErrors.first("password"))+" ")])],1),s("b-button",{staticClass:"btn-md",attrs:{variant:"dark"},on:{click:function(e){return t.submitForm()}}},[t._v("Sign in ")])],1),s("div",{staticClass:"text-left",staticStyle:{"margin-top":"1em"}},[s("router-link",{attrs:{to:"/register"}},[t._v("Need an account?")])],1)],1)])])])},ot=[],it={data(){return{form:{username:"",password:""}}},computed:{...Object(l["c"])({isLoggedIn:"isLoggedIn"})},methods:{...Object(l["b"])({logIn:"logIn"}),validateState(t){return this.veeFields[t]&&(this.veeFields[t].dirty||this.veeFields[t].validated)?!this.veeErrors.has(t):null},submitForm(){const t=this,e=this.form;this.$validator.validateAll().then(s=>{s&&this.logIn({formData:e}).then(e=>{t.$router.push({path:"/"})}).catch(t=>{d(this.$bvToast,"Error: could not login","Cause: "+t.response.data.message)})})}},created(){this.isLoggedIn&&this.$router.push({path:"/"})}},nt=it,rt=Object(m["a"])(nt,at,ot,!1,null,null,null),lt=rt.exports,ct=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{staticClass:"row justify-content-center align-items-center",attrs:{id:"login-row"}},[s("div",{staticClass:"col-md-6",attrs:{id:"login-column"}},[s("div",{staticClass:"col-md-12",attrs:{id:"login-box"}},[s("b-form",{ref:"registrationForm",attrs:{model:t.registrationForm,autocomplete:"off"}},[s("h3",{staticClass:"text-center "},[t._v("Register")]),s("b-form-group",{staticClass:"form-group",attrs:{id:"input-group-1","label-for":"username"}},[s("label",{},[t._v("Username:")]),s("br"),s("b-form-input",{directives:[{name:"validate",rawName:"v-validate",value:{required:!0},expression:"{ required: true }"}],staticClass:"form-control",attrs:{id:"username",name:"username",state:t.validateState("username")},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.submitForm()}},model:{value:t.registrationForm.username,callback:function(e){t.$set(t.registrationForm,"username",e)},expression:"registrationForm.username"}}),s("b-form-invalid-feedback",{attrs:{id:"username"}},[t._v(t._s(t.veeErrors.first("username"))+" ")])],1),s("b-form-group",{attrs:{id:"input-group-2","label-for":"password"}},[s("label",{},[t._v("Password:")]),s("br"),s("b-form-input",{directives:[{name:"validate",rawName:"v-validate",value:{required:!0},expression:"{ required: true }"}],ref:"password",attrs:{id:"password",name:"password",type:"password",state:t.validateState("password")},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.submitForm()}},model:{value:t.registrationForm.password,callback:function(e){t.$set(t.registrationForm,"password",e)},expression:"registrationForm.password"}}),s("b-form-invalid-feedback",{attrs:{id:"password"}},[t._v(t._s(t.veeErrors.first("password"))+" ")])],1),s("b-form-group",{attrs:{id:"input-group-3","label-for":"confirmedPassword"}},[s("label",{},[t._v("Confirm your password:")]),s("br"),s("b-form-input",{directives:[{name:"validate",rawName:"v-validate",value:"required|confirmed:password",expression:"'required|confirmed:password'"}],attrs:{id:"confirmedPassword",name:"confirmedPassword",type:"password",state:t.validateState("confirmedPassword")},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.submitForm()}},model:{value:t.registrationForm.confirmedPassword,callback:function(e){t.$set(t.registrationForm,"confirmedPassword",e)},expression:"registrationForm.confirmedPassword"}}),s("b-form-invalid-feedback",{attrs:{id:"confirmedPassword"}},[t._v(t._s(t.veeErrors.first("confirmedPassword"))+" ")])],1),s("b-form-group",{attrs:{id:"input-group-4","label-for":"email"}},[s("label",[t._v("Email:")]),s("br"),s("b-form-input",{directives:[{name:"validate",rawName:"v-validate",value:{required:!0,email:!0},expression:"{ required: true, email: true }"}],attrs:{id:"email",name:"email",type:"email",state:t.validateState("email")},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.submitForm()}},model:{value:t.registrationForm.email,callback:function(e){t.$set(t.registrationForm,"email",e)},expression:"registrationForm.email"}}),s("b-form-invalid-feedback",{attrs:{id:"email"}},[t._v(t._s(t.veeErrors.first("email"))+" ")])],1),s("b-button",{staticClass:"btn-md",attrs:{variant:"dark"},on:{click:function(e){return t.submitForm()}}},[t._v("Register")])],1),s("br"),s("div",{staticClass:"text-left"},[s("router-link",{attrs:{to:"/login"}},[t._v("Already have an account?")])],1)],1)])])])},dt=[],ut={data(){return{registrationForm:{username:"",password:"",confirmedPassword:"",email:""}}},methods:{...Object(l["b"])({register:"registerAccount"}),validateState(t){return this.veeFields[t]&&(this.veeFields[t].dirty||this.veeFields[t].validated)?!this.veeErrors.has(t):null},submitForm(){const t=this;this.$validator.validateAll().then(e=>{if(e){const e=this.registrationForm;this.register({registrationForm:e}).then(e=>t.$router.push("/")).catch(t=>d(this.$bvToast,"Cannot register","Cause "+t.response.data.message))}})}}},pt=ut,mt=Object(m["a"])(pt,ct,dt,!1,null,null,null),ht=mt.exports,gt=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("b-container",{on:{dragover:function(e){return e.preventDefault(),t.beginDrag.apply(null,arguments)}}},[s("b-row",{staticClass:"justify-content-center"},[s("b-col",{attrs:{cols:"12"}},[s("h2",{staticClass:"page-title"},[t._v(" Your banks "),s("b-button",{directives:[{name:"tippy",rawName:"v-tippy",value:{arrow:!0,arrowType:"round",theme:"google"},expression:"{arrow: true, arrowType: 'round', theme: 'google'}"}],staticClass:"upload-button",attrs:{variant:"outline-primary",content:"You can also drag and drop archives to this page to upload them!"},on:{click:function(e){t.showUpload=!0}}},[s("b-icon-cloud-upload")],1)],1)])],1),s("div",{staticClass:"bank-list"},t._l(t.availableBanks,(function(e){return s("b-row",{key:e.id,staticClass:"justify-content-center"},[s("b-col",{attrs:{cols:"12"}},[s("router-link",{attrs:{to:"/bank/"+e.id}},[s("b-card",{staticClass:"card-hover bank-list-card"},[s("b-card-title",[t._v(" "+t._s(e.name)+" ")]),s("b-card-text",{staticClass:"text-muted"},[t._v(" "+t._s(e.description)+" ")])],1)],1)],1)],1)})),1),s("div",{class:"upload-section"+(t.showUpload?" upload-section-shown":""),on:{dragleave:t.stopDrag}},[s("div",{class:"upload-shadow"+(t.showUpload?" upload-shadow-shown":"")}),s("div",{staticClass:"upload-modal",on:{drop:t.chooseFile}},[s("b-container",{attrs:{fluid:""}},[s("b-row",{staticClass:"justify-content-end",staticStyle:{"margin-bottom":"1em"}},[s("b-col",{attrs:{cols:"1"}},[s("b-button",{attrs:{variant:"outline-secondary"},on:{click:function(e){t.showUpload=!1}}},[s("b-icon-x-circle")],1)],1)],1),s("b-row",{staticClass:"justify-content-center"},[s("b-col",{attrs:{cols:"12"}},[null===t.bankFile?s("div",{staticClass:"upload-input"},[s("input",{ref:"hidden-upload",staticClass:"hidden-upload",attrs:{type:"file",accept:".zip",id:"file-upload"},on:{change:t.checkFiles}}),s("b-button",{staticClass:"cloud-upload-button",attrs:{variant:"primary"},on:{click:function(e){return t.$refs["hidden-upload"].click()}}},[s("b-icon-file-earmark-arrow-up")],1),s("p",{staticClass:"no-drag suggest-drag-text"},[t._v("Drop your zip file containing your bank")])],1):s("div",{staticClass:"upload-input"},[s("p",[t._v("You chose the file "+t._s(t.bankFile.name)+". "),s("br"),s("a",{staticStyle:{"font-size":"80%"},attrs:{href:"javascript:void(0)"},on:{click:t.clearSelection}},[t._v("Clear selection")])]),s("b-button",{staticClass:"cloud-upload-button",staticStyle:{"font-size":"1em"},attrs:{variant:"primary"},on:{click:t.uploadBank}},[t._v("Upload")])],1)])],1)],1)],1)])],1)},bt=[],ft={name:"BankList",data(){return{availableBanks:[],showUpload:!1,bankFile:null}},methods:{...Object(l["b"])({listBanks:"listBanks",uploadBankRemote:"uploadBank"}),updateBanks(){this.listBanks().then(t=>this.availableBanks=t.data).catch(t=>d(this.$bvToast,"Cannot list banks","Cause: "+t.response.data.message))},beginDrag(t){t.stopPropagation();const e=t.dataTransfer;this.showUpload=e.types&&e.types.indexOf&&-1!==e.types.indexOf("Files"),t.dataTransfer.effectAllowed="all",t.dataTransfer.dropEffect="all"},stopDrag(t){this.showUpload=!1},chooseFile(t){t.preventDefault();const e=t.dataTransfer.files;0!==e.length&&e[0].name.endsWith(".zip")&&(this.bankFile=e[0])},checkFiles(t){if(this.$refs["hidden-upload"].files.length<1)return;const e=this.$refs["hidden-upload"].files[0];this.bankFile=e},clearSelection(){this.bankFile=null},uploadBank(){if(null===this.bankFile)return void d(this.$bvToast,"Cannot upload file","No file has been selected.");const t=new FormData;t.append("file",this.bankFile),this.uploadBankRemote({formData:t}).then(t=>{this.$bvToast.toast(t.data.message,{title:"Successfully uploaded bank!",variant:"success",solid:!0}),this.showUpload=!1,this.updateBanks()}).catch(t=>d(this.$bvToast,"Could not upload bank","Cause: "+t.response.data.message))}},created(){this.updateBanks()}},vt=ft,yt=(s("980a"),Object(m["a"])(vt,gt,bt,!1,null,"48504eb9",null)),kt=yt.exports,wt=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("b-container",[s("b-row",[s("b-col",{attrs:{cols:"12"}},[s("h2",[t._v("Your profile")])])],1),s("b-row",[s("b-col",{attrs:{md:"8",xs:"12"}},[s("b-form",[s("label",{attrs:{for:"username-input"}},[t._v("Username")]),s("b-form-input",{staticClass:"mb-2",attrs:{type:"text",id:"username-input",disabled:"",value:t.currentUser.username}}),s("label",{attrs:{for:"email-input"}},[t._v("Email")]),s("b-form-input",{attrs:{type:"text",id:"email-input",disabled:"",value:t.currentUser.email}})],1)],1),s("b-col",{attrs:{md:"4",xs:"12"}},[s("profile-picture",{attrs:{picture:t.$hostname+"/api/profile-picture/"+t.currentUser.username,editable:!0}})],1)],1)],1)},_t=[],xt=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{staticClass:"profile-picture",style:"background-image: url("+t.picture+")"}),Boolean(t.editable)?s("p",{staticClass:"text-center",on:{click:function(e){return t.openUploadModal()}}},[s("a",{attrs:{href:"#"}},[t._v("Upload a new picture")])]):t._e(),s("b-modal",{attrs:{size:"lg",title:"New avatar",id:"upload-picture","hide-footer":""}},[s("b-row",{staticClass:"mb-2"},[s("b-col",{attrs:{cols:"12"}},[s("b-form-file",{attrs:{state:Boolean(t.pictureToUpload),accept:"image/jpeg",placeholder:"Upload a new profile picture (.jpg)","drop-placeholder":"Drop your file here"},model:{value:t.pictureToUpload,callback:function(e){t.pictureToUpload=e},expression:"pictureToUpload"}})],1)],1),s("b-row",[s("b-col",{attrs:{md:"6",xs:"12"}},[s("b-button",{staticClass:"mb-2",attrs:{variant:"primary",disabled:!t.pictureToUpload},on:{click:function(e){return t.submitImage()}}},[s("span",{staticClass:"mr-2"},[t._v("OK")]),s("b-icon-upload")],1)],1),s("b-col",{staticClass:"d-flex justify-content-md-end",attrs:{md:"6",xs:"12"}},[s("b-button",{attrs:{variant:"danger"},on:{click:function(e){return t.cancel()}}},[t._v("Cancel")])],1)],1)],1)],1)},Ct=[],It={name:"ProfilePicture",data(){return{pictureToUpload:null}},props:{picture:{required:!0,type:String},editable:{required:!1,type:Boolean}},methods:{...Object(l["b"])({uploadProfilePicture:"uploadProfilePicture"}),openUploadModal(){this.$bvModal.show("upload-picture")},cancel(){this.pictureToUpload=null,this.$bvModal.hide("upload-picture")},submitImage(){this.$bvModal.hide("upload-picture");const t=new FormData;t.append("file",this.pictureToUpload,this.pictureToUpload.name),this.uploadProfilePicture({formData:t}).catch(t=>d(this.$bvToast,"Could not upload picture","Cause "+t.response.data.message))}}},Pt=It,Tt=(s("be2e"),Object(m["a"])(Pt,xt,Ct,!1,null,"82de5c6a",null)),Dt=Tt.exports,Nt={name:"Settings",components:{ProfilePicture:Dt},computed:{...Object(l["c"])({currentUser:"currentUser"})},data(){return{profilePicture:null,imagePlaceholder:{blank:!0,blankColor:"#777",width:75,height:75,class:"m1"}}}},Ot=Nt,Bt=(s("ef23"),Object(m["a"])(Ot,wt,_t,!1,null,null,null)),At=Bt.exports,$t=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("b-container",[s("b-row",[s("b-col",{attrs:{cols:"12"}},[s("h2",[t._v("User profile")])])],1),s("b-row",[s("b-col",{attrs:{md:"8",xs:"12"}},[s("b-form",[s("label",{attrs:{for:"username-input"}},[t._v("Username")]),s("b-form-input",{staticClass:"mb-2",attrs:{type:"text",id:"username-input",disabled:"",value:t.username}}),s("label",{attrs:{for:"email-input"}},[t._v("Email")]),s("b-form-input",{attrs:{type:"text",id:"email-input",disabled:"",value:t.email}})],1)],1),s("b-col",{attrs:{md:"4",xs:"12"}},[s("profile-picture",{attrs:{picture:t.$hostname+"/api/profile-picture/"+t.username,editable:!1}})],1)],1)],1)},St=[],Et={name:"Profile",data(){return{username:"",email:""}},components:{ProfilePicture:Dt},methods:{...Object(l["b"])({fetchUserData:"fetchUserData"})},created(){this.fetchUserData({username:this.$route.params.username}).then(t=>{this.username=t.data.username,this.email=t.data.email}).catch(t=>d(this.$bvToast,"Could not load user info","Cause: "+t.response.data.message))}},Ut=Et,jt=Object(m["a"])(Ut,$t,St,!1,null,null,null),Ft=jt.exports;a["default"].use(P["a"]);var Ht=new P["a"]({mode:"history",base:"/",routes:[{path:"/",name:"BankList",component:kt},{path:"/annotate/:imageId",name:"AnnotateImage",component:Y},{path:"/bank/:bankId",name:"ImageList",component:st},{path:"/login",name:"Login",component:lt,meta:{noAuth:!0}},{path:"/register",name:"Register",component:ht,meta:{noAuth:!0}},{path:"/settings",name:"Settings",component:At},{path:"/profile/:username",name:"Profile",component:Ft}]}),Lt=s("0e44"),qt=s("bc3a"),Rt=s.n(qt),Vt=s("852e");const Yt={userInfo:null},Mt={setUserInfo(t,{userInfo:e}){t.userInfo=e},deleteInfo(t){t.userInfo=null}},Xt={logIn({commit:t},{formData:e}){return Rt.a.post("/login",e).then(e=>{const s=e.data;t("setUserInfo",{userInfo:s})})},logOut({commit:t}){return Rt.a.post("/logout").then(e=>{t("deleteInfo")})},registerAccount({commit:t},{registrationForm:e}){return Rt.a.post("/register",e).then(e=>{const s=e.data;t("setUserInfo",{userInfo:s})})}},zt={currentUser(t){return t.userInfo},isLoggedIn(t){return Vt["get"]("session"),t.userInfo,!!Vt["get"]("session")&&!!t.userInfo}};var Jt={state:Yt,getters:zt,actions:Xt,mutations:Mt};const Wt={listBanks({dispatch:t}){return Rt.a.get("/api/bank-list")},listImages({dispatch:t},{bankId:e}){return Rt.a.get("/api/bank/"+e)},listAccesses({dispatch:t},{bankId:e}){return Rt.a.get("/api/bank-list-accesses/"+e)},requestPermission({dispatch:t},{targetUser:e,level:s,bankId:a}){return Rt.a.put("/api/bank-access",{targetName:e,level:s,id:a})},fetchImageData({dispatch:t},{imageId:e}){return Rt.a.get("/api/image/"+e)},sendAnnotations({dispatch:t},{data:e}){return Rt.a.post("/api/image/annotate",e)},requestBankJson({dispatch:t},{bankId:e}){return Rt.a.get("/api/bank/json/"+e)},uploadBank({dispatch:t},{formData:e}){return Rt.a.post("/api/bank/upload",e,{headers:{"Content-Type":"multipart/form-data"}})},deleteBank({dispatch:t},{bankId:e}){return Rt.a.get("/api/bank/delete/"+e)}};var Zt={actions:Wt};const Gt={uploadProfilePicture({dispatch:t},{formData:e}){return Rt.a.post("/api/profile-picture",e,{headers:{"Content-Type":"multipart/form-data"}})},fetchUserData({dispatch:t},{username:e}){return Rt.a.get("/api/user-info/"+e)}};var Kt={actions:Gt};a["default"].use(l["a"]);const Qt=new l["a"].Store({modules:{auth:Jt,images:Zt,profiles:Kt},plugins:[Object(Lt["a"])({getState:t=>Vt["get"](t)?JSON.parse(Vt["get"](t)):null,setState:(t,e)=>Vt["set"](t,JSON.stringify(e))})]});var te=Qt,ee=(s("f9e3"),s("5f5b")),se=s("b1e0"),ae=(s("2dd8"),s("7bb1"));Ht.beforeEach((t,e,s)=>{t.meta.noAuth||te.getters.isLoggedIn?s():s({path:"/login"})});s("7842");Rt.a.defaults.withCredentials=!0;const oe="https://butterfly-annotator.herokuapp.com";Rt.a.defaults.baseURL=oe,a["default"].prototype.$hostname=oe,a["default"].use(ee["a"]),a["default"].use(se["a"]),a["default"].use(ae,{inject:!0,fieldsBagName:"veeFields",errorBagName:"veeErrors"}),a["default"].use(B["b"],{directive:"tippy"}),a["default"].component("tippy",B["a"]),a["default"].config.productionTip=!1,a["default"].use(ee["a"]),new a["default"]({store:te,router:Ht,render:t=>t(I)}).$mount("#app")},6369:function(t,e,s){},6860:function(t,e,s){},"760c":function(t,e,s){"use strict";s("c3f5")},"85ec":function(t,e,s){},8853:function(t,e,s){},"8baf":function(t,e,s){"use strict";s("6860")},"980a":function(t,e,s){"use strict";s("8853")},"9d0d":function(t,e,s){"use strict";s("a206")},a206:function(t,e,s){},be2e:function(t,e,s){"use strict";s("6369")},c3f5:function(t,e,s){},c967:function(t,e,s){},d5e7:function(t,e,s){"use strict";s("423e")},ef23:function(t,e,s){"use strict";s("c967")},fa66:function(t,e,s){"use strict";s("5697")}});
//# sourceMappingURL=app.1f158930.js.map